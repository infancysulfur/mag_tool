<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ë¹„ì¦ˆë‹ˆìŠ¤ ì»¬ëŸ¬ ë§¤ë‹ˆì €</title>
    <style>
      :root {
        --sidebar-width: 240px;
        --primary-color: #34495e;
        --accent-color: #1a73e8;
        --bg-color: #f4f7f6;
      }

      body {
        margin: 0;
        font-family: "Pretendard", "Malgun Gothic", sans-serif;
        display: flex;
        height: 100vh;
        background-color: var(--bg-color);
        color: #2c3e50;
      }

      /* --- ì‚¬ì´ë“œë°” --- */
      .sidebar {
        width: var(--sidebar-width);
        background-color: white;
        border-right: 1px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
      }

      .logo-area {
        padding: 30px 20px;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--primary-color);
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        text-align: center;
      }

      .menu-list {
        padding: 20px 0;
        flex-grow: 1;
      }

      .menu-item {
        padding: 15px 25px;
        cursor: pointer;
        transition: 0.2s;
        color: #636e72;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-item:hover {
        background-color: #f8f9fa;
      }
      .menu-item.active {
        background-color: #e8f0fe;
        color: var(--accent-color);
        border-right: 4px solid var(--accent-color);
      }

      /* --- ë©”ì¸ ì˜ì—­ --- */
      .main-container {
        flex-grow: 1;
        overflow-y: auto;
        padding: 40px;
      }

      .content-card {
        max-width: 1100px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        padding: 30px;
        min-height: 600px;
      }

      /* --- íŒ”ë ˆíŠ¸ íƒ­ ê·¸ë¦¬ë“œ --- */
      .app-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 40px;
      }

      .palette-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 4px;
        margin-top: 15px;
      }

      .color-cell {
        aspect-ratio: 1;
        cursor: pointer;
        border-radius: 4px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.1s;
      }

      .color-cell:hover {
        transform: scale(1.1);
        z-index: 2;
        border: 1px solid #000;
      }

      .preview-bar {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 25px;
      }

      .color-box {
        width: 100px;
        height: 50px;
        border-radius: 8px;
        border: 1px solid #ddd;
        cursor: pointer;
      }

      .hex-input {
        width: 120px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: monospace;
        font-size: 1.1em;
      }

      /* --- ë¶„ì„ ê²°ê³¼ ì•„ì´í…œ --- */
      .analysis-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #edf2f7;
      }

      .analysis-item {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        padding: 12px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
      }

      /* --- ìƒ‰ìƒ ì„ê¸° ì˜ì—­ --- */
      .mix-result-area {
        width: 100%;
        height: 120px;
        border-radius: 12px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3em;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      .mix-row {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 12px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
      }

      input[type="number"] {
        width: 60px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .btn-add {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="logo-area" onclick="location.reload()">ğŸ  COLOR LAB</div>
      <nav class="menu-list">
        <div class="menu-item active" onclick="switchTab(0, this)">
          ğŸ¨ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        </div>
        <div class="menu-item" onclick="switchTab(1, this)">ğŸ§ª ìƒ‰ìƒ ì„ê¸°</div>
        <div class="menu-item">ğŸ“‘ íˆìŠ¤í† ë¦¬ (ì¤€ë¹„ì¤‘)</div>
      </nav>
    </div>

    <main class="main-container">
      <div class="content-card">
        <div id="palette-tab" class="tab-content">
          <h2 style="margin-bottom: 25px">ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ë¶„ì„</h2>
          <div class="app-grid">
            <div class="left-panel">
              <div class="preview-bar">
                <div class="picker-wrapper" style="position: relative">
                  <div
                    id="displayBox"
                    class="color-box"
                    onclick="document.getElementById('hiddenPicker').showPicker()"
                  ></div>
                  <input
                    type="color"
                    id="hiddenPicker"
                    oninput="syncFromPicker(this.value)"
                    style="
                      position: absolute;
                      left: 0;
                      bottom: 0;
                      width: 0;
                      height: 0;
                      border: none;
                      padding: 0;
                      visibility: hidden;
                    "
                  />
                </div>

                <input
                  type="text"
                  id="hexDisplay"
                  class="hex-input"
                  onchange="syncFromHex()"
                />
                <button class="btn-add" onclick="syncFromHex()">ì¡°íšŒ</button>
              </div>
              <div class="palette-grid" id="grid"></div>
            </div>

            <div class="right-panel">
              <h4>ë¶„ì„ ê²°ê³¼</h4>
              <div class="analysis-section">
                <h5 style="margin-top: 0">ğŸ¨ í•œê¸€ ìƒ‰ìƒ ì´ë¦„ ë¶„ì„ (Top 3)</h5>
                <div id="koreanResultArea">
                  <span style="color: #a0aec0">ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”.</span>
                </div>
              </div>

              <div style="margin-top: 25px">
                <p>
                  <strong>RGB:</strong>
                  <input type="number" id="r_in" oninput="syncFromRgb()" />
                  <input type="number" id="g_in" oninput="syncFromRgb()" />
                  <input type="number" id="b_in" oninput="syncFromRgb()" />
                </p>
                <p>
                  <strong>CMYK:</strong> C<input
                    type="number"
                    id="c_in"
                    readonly
                  />% M<input type="number" id="m_in" readonly />% Y<input
                    type="number"
                    id="y_in"
                    readonly
                  />% K<input type="number" id="k_in" readonly />%
                </p>
              </div>
            </div>
          </div>
        </div>

        <div id="mixer-tab" class="tab-content" style="display: none">
          <h2>ìƒ‰ìƒ ì„ê¸° (Color Mixer)</h2>
          <div id="mixResult" class="mix-result-area">
            ê²°ê³¼ ìƒ‰ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
          </div>
          <div id="mixRowsContainer">
            <div class="mix-row">
              <input type="color" value="#ff0000" oninput="calculateMix()" />
              <span>ìš©ëŸ‰:</span>
              <input type="number" value="1" min="1" oninput="calculateMix()" />
            </div>
            <div class="mix-row">
              <input type="color" value="#0000ff" oninput="calculateMix()" />
              <span>ìš©ëŸ‰:</span>
              <input type="number" value="1" min="1" oninput="calculateMix()" />
            </div>
          </div>
          <button class="btn-add" onclick="addMixRow()">+ í–‰ ì¶”ê°€</button>
          <button
            class="btn-add"
            style="background: #e74c3c"
            onclick="removeMixRow()"
          >
            - ì œê±°
          </button>
        </div>
      </div>
    </main>

    <script>
      // --- ê³µí†µ: íƒ­ ì „í™˜ ---
      function switchTab(index, element) {
        document
          .querySelectorAll(".menu-item")
          .forEach((m) => m.classList.remove("active"));
        element.classList.add("active");

        const pTab = document.getElementById("palette-tab");
        const mTab = document.getElementById("mixer-tab");

        if (index === 0) {
          pTab.style.display = "block";
          mTab.style.display = "none";
        } else {
          pTab.style.display = "none";
          mTab.style.display = "block";
          calculateMix();
        }
      }

      // --- íŒ”ë ˆíŠ¸ ì´ˆê¸°í™” ---
      function initPalette() {
        const grid = document.getElementById("grid");
        for (let i = 0; i < 72; i++) {
          const cell = document.createElement("div");
          cell.className = "color-cell";
          const h = (i % 12) * 30;
          const l = 30 + Math.floor(i / 12) * 10;
          cell.style.backgroundColor = `hsl(${h}, 70%, ${l}%)`;
          cell.onclick = () => {
            const rgb = getRGBfromCSS(cell.style.backgroundColor);
            updateAll(rgb.r, rgb.g, rgb.b, "palette");
          };
          grid.appendChild(cell);
        }
      }

      function getRGBfromCSS(str) {
        const match = str.match(/\d+/g);
        return {
          r: parseInt(match[0]),
          g: parseInt(match[1]),
          b: parseInt(match[2]),
        };
      }

      // --- ìƒ‰ìƒ ì—…ë°ì´íŠ¸ ë¡œì§ ---
      async function updateAll(r, g, b, trigger) {
        const hex =
          "#" +
          [r, g, b]
            .map((x) => x.toString(16).padStart(2, "0"))
            .join("")
            .toUpperCase();

        document.getElementById("displayBox").style.backgroundColor = hex;
        if (trigger !== "hex")
          document.getElementById("hexDisplay").value = hex;
        if (trigger !== "rgb") {
          document.getElementById("r_in").value = r;
          document.getElementById("g_in").value = g;
          document.getElementById("b_in").value = b;
        }

        // CMYK ë³€í™˜
        let c = 1 - r / 255,
          m = 1 - g / 255,
          y = 1 - b / 255,
          k = Math.min(c, m, y);
        if (k === 1) {
          c = 0;
          m = 0;
          y = 0;
          k = 100;
        } else {
          c = Math.round(((c - k) / (1 - k)) * 100);
          m = Math.round(((m - k) / (1 - k)) * 100);
          y = Math.round(((y - k) / (1 - k)) * 100);
          k = Math.round(k * 100);
        }
        document.getElementById("c_in").value = c;
        document.getElementById("m_in").value = m;
        document.getElementById("y_in").value = y;
        document.getElementById("k_in").value = k;

        sendToAnalyze(c, m, y, k);
      }

      function syncFromPicker(hex) {
        const r = parseInt(hex.slice(1, 3), 16),
          g = parseInt(hex.slice(3, 5), 16),
          b = parseInt(hex.slice(5, 7), 16);
        updateAll(r, g, b, "picker");
      }

      function syncFromHex() {
        const hex = document.getElementById("hexDisplay").value;
        if (/^#[0-9A-F]{6}$/i.test(hex)) {
          syncFromPicker(hex);
        }
      }

      function syncFromRgb() {
        const r = parseInt(document.getElementById("r_in").value) || 0,
          g = parseInt(document.getElementById("g_in").value) || 0,
          b = parseInt(document.getElementById("b_in").value) || 0;
        updateAll(r, g, b, "rgb");
      }

      // --- ì„œë²„ ë¶„ì„ ìš”ì²­ ---
      async function sendToAnalyze(c, m, y, k) {
        const resultDiv = document.getElementById("koreanResultArea");
        try {
          const response = await fetch("/get_korean_name", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ cmyk: { c, m, y, k } }),
          });
          const data = await response.json();
          if (data && data.length > 0) {
            resultDiv.innerHTML = data
              .map((item, index) => {
                const colorHex = item.hex || "#cccccc";
                const isFirst = index === 0;
                return `
                    <div class="analysis-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                        <div class="color-dot" style="width: 20px; height: 20px; border-radius: 50%; background-color: ${colorHex}; border: 1px solid rgba(0,0,0,0.1); flex-shrink: 0;"></div>
                        <div style="flex-grow: 1;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 0.95em; font-weight: ${isFirst ? "bold" : "normal"}; color: #2d3748;">${index + 1}. ${item.name}</span>
                                <span style="font-size: 0.85em; color: #718096;">${item.similarity}%</span>
                            </div>
                            <div style="width: 100%; height: 6px; background: #edf2f7; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${item.similarity}%; height: 100%; background: ${isFirst ? "#3182ce" : "#a0aec0"}; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>`;
              })
              .join("");
          }
        } catch (e) {
          resultDiv.innerHTML = "ë°ì´í„° ì—°ë™ ëŒ€ê¸° ì¤‘...";
        }
      }

      // --- ìƒ‰ìƒ ì„ê¸° ë¡œì§ ---
      function calculateMix() {
        const rows = document.querySelectorAll(".mix-row");
        let rT = 0,
          gT = 0,
          bT = 0,
          aT = 0;
        rows.forEach((row) => {
          const c = row.querySelector('input[type="color"]').value;
          const a =
            parseFloat(row.querySelector('input[type="number"]').value) || 0;
          rT += parseInt(c.slice(1, 3), 16) * a;
          gT += parseInt(c.slice(3, 5), 16) * a;
          bT += parseInt(c.slice(5, 7), 16) * a;
          aT += a;
        });
        if (aT > 0) {
          const fH =
            "#" +
            [Math.round(rT / aT), Math.round(gT / aT), Math.round(bT / aT)]
              .map((x) => x.toString(16).padStart(2, "0"))
              .join("")
              .toUpperCase();
          const res = document.getElementById("mixResult");
          res.style.backgroundColor = fH;
          res.innerText = `í˜¼í•© ê²°ê³¼: ${fH}`;
        }
      }

      function addMixRow() {
        const container = document.getElementById("mixRowsContainer");
        const div = document.createElement("div");
        div.className = "mix-row";
        div.innerHTML = `<input type="color" value="#ffffff" oninput="calculateMix()"> <span>ìš©ëŸ‰:</span> <input type="number" value="1" min="1" oninput="calculateMix()">`;
        container.appendChild(div);
      }

      function removeMixRow() {
        const container = document.getElementById("mixRowsContainer");
        if (container.children.length > 2)
          container.removeChild(container.lastChild);
        calculateMix();
      }

      initPalette();
      updateAll(255, 0, 0, "init");
    </script>
  </body>
</html>
